<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <title>CS120 Wordle</title>
    <style>
    </style>
    <link rel="stylesheet" type="text/css" href="main.css"/>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script type="text/javascript" src="index.js"></script>
    <script type="text/javascript" src="getWordleWord.js"></script>
    <script>
        async function getWord(gameReset){
            let currentRow = 0;
            let greenCt = 0;
            let word;
            let gameFinished = false;
            let validWord = false;
            word = await getWordleWord()
            let wCheck = await checkValidWord(word)
            while(!wCheck) {
                // continue to hit endpoint until we get a valid word
                word = await getWordleWord()
                wCheck = await checkValidWord(word, false)
            }
            console.log("This games word is: ", word)

            if(!gameReset) {
                for (let i = 0; i < 6; ++i){
                    let currentDiv = document.getElementById('row' + i);
                    let letterCells = initRows(i);

                    letterCells.forEach(element => {
                        currentDiv.appendChild(element);
                    });
                }

                qRowLetters = ['Q', 'W', 'E', 'R', 'T', 'Y', 'U', 'I', 'O', 'P']
                aRowLetters = ['A', 'S', 'D', 'F', 'G', 'H', 'J', 'K', 'L']
                zRowLetters = ['Z', 'X', 'C', 'V', 'B', 'N', 'M']
                initLetterBoard(qRowLetters, 'q')
                initLetterBoard(aRowLetters, 'a')
                initLetterBoard(zRowLetters, 'z')
            }


            $(document).ready(function(){
                $('#guessBtn').click(
                    async function() {
                        // check for valid word and update board accordingly
                        // If we get 5 green letters or use all 6 guesses, enter end game state
                        let guess = $("#guessVal").val();
                        validWord = await checkValidWord(guess, true);
                        if(validWord){
                            let newCells = getCellsForGuess(guess, word);
                            updateBoard(newCells, currentRow, word);
                            greenCt = countGreenCells(newCells);
                            currentRow++;
                            if(greenCt == 5){
                                currentRow = 0;
                                gameFinished = true;
                                $('#resetBtn').toggle(gameFinished);
                                alert(`You got it right! The correct word is '${word}'`);
                            }

                            if(currentRow == 6 && greenCt != 5){
                                currentRow = 0;
                                gameFinished = true;
                                $('#resetBtn').toggle(gameFinished);
                                alert(`You used all your gueses. The word is '${word}'`);
                            }
                        }
                    })
            })
        }
        getWord(false)
    </script>
</head>


<body>
    <h2>Welcome to Wordle!</h2>

    <div class="row" id="row0"></div>
    <div class="row" id="row1"></div>
    <div class="row" id="row2"></div>
    <div class="row" id="row3"></div>
    <div class="row" id="row4"></div>
    <div class="row" id="row5"></div>


    <div>
        <form>
            <label >What is your guess?:</label><br>
            <input type="text" id="guessVal"> <br>
            <input type="button" value="Check My Guess" id="guessBtn">
            <input type="button" style="display: none" value="New Game" id="resetBtn" onclick="clearBoard(); getWord(true)">
        </form>
    </div>

    <div class="letterBoard">
        <div class="qRow" id="qRow"></div>
        <div class="aRow" id="aRow"></div>
        <div class="zRow" id="zRow"></div>
    </div>
   
</body>